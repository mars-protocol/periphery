[tasks.generate-all-schemas]
script_runner = "@rust"
script = '''
use std::{fs, io::Result, process::Command};

fn main() -> Result<()> {
    fs::remove_dir_all("schema");
    fs::remove_dir_all("schemas");
    fs::create_dir("schemas")?;
    println!("ðŸ¤– Created `schemas` directory");

    let contracts = vec![
        "mars-vesting",
        "mars-airdrop",
        "mars-delegator",
    ];

    for contract in contracts {
        println!("ðŸ¤– Generating schema for `{}` contract", contract);

        let output = Command::new("cargo")
            .arg("run")
            .arg("--package")
            .arg(contract)
            .arg("--example")
            .arg("schema")
            .output()
            .expect("failed to execute process");

        println!("status: {}", output.status);
        println!("stdout: {}", String::from_utf8_lossy(&output.stdout));
        println!("stderr: {}", String::from_utf8_lossy(&output.stderr));

        fs::create_dir(format!("schemas/{}", contract))?;

        fs::rename(
            format!("schema/{}.json", contract),
            format!("schemas/{}/{}.json", contract, contract),
        )?;
    }

    fs::remove_dir_all("schema");

    Ok(())
}
'''
